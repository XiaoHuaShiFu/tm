<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xiaohuashifu.tm.dao.MeetingMapper">
	<sql id="BaseColumnList">
        id, user_id, name, start_time, end_time, place, department, content, state, create_time, update_time
    </sql>

	<select id="listMeetings" parameterType="com.xiaohuashifu.tm.pojo.query.MeetingQuery" resultType="com.xiaohuashifu.tm.pojo.do0.MeetingDO">
		select
		<include refid="BaseColumnList"/>
		from meeting
		<where>
			<if test="id != null">
				and id = #{id, jdbcType=INTEGER}
			</if>
			<if test="name != null">
				and name = #{name, jdbcType=VARCHAR}
			</if>
			<if test="place != null">
				and place = #{place, jdbcType=VARCHAR}
			</if>
			<if test="state != null">
				and state = #{state, jdbcType=CHAR}
			</if>
			<if test="department != null">
				and FIND_IN_SET(#{department, jdbcType=CHAR}, department)
			</if>
		</where>
		order by update_time desc
	</select>

	<insert id="saveMeeting" parameterType="com.xiaohuashifu.tm.pojo.do0.MeetingDO" useGeneratedKeys="true"
			keyProperty="id">
		insert into meeting(user_id, name, start_time, end_time, place, department, content)
		values (#{userId, jdbcType=INTEGER}, #{name, jdbcType=VARCHAR}, #{startTime, jdbcType=DATE},
		#{endTime, jdbcType=DATE}, #{place, jdbcType=VARCHAR}, #{department, jdbcType=CHAR}, #{content, jdbcType=VARCHAR})
	</insert>

	<select id="getMeeting" parameterType="integer" resultType="com.xiaohuashifu.tm.pojo.do0.MeetingDO">
		select
		<include refid="BaseColumnList"/>
		from meeting
		where id = #{id, jdbcType=INTEGER}
		order by update_time desc
	</select>

	<select id="countByIdAndUserId" parameterType="map" resultType="integer">
		select
		count(*)
		from meeting
		where id = #{id, jdbcType=INTEGER} and user_id = #{userId, jdbcType=INTEGER}
	</select>

	<update id="updateMeeting" parameterType="com.xiaohuashifu.tm.pojo.do0.MeetingDO">
		update meeting
		<set>
			<if test="content != null">
				content = #{content, jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				name = #{name, jdbcType=VARCHAR},
			</if>
			<if test="startTime != null">
				start_time = #{startTime, jdbcType=DATE},
			</if>
			<if test="endTime != null">
				end_time = #{endTime, jdbcType=DATE},
			</if>
			<if test="place != null">
				place = #{place, jdbcType=VARCHAR},
			</if>
			<if test="department != null">
				department = #{department, jdbcType=VARCHAR},
			</if>
			<if test="state != null">
				state = #{state, jdbcType=CHAR},
			</if>
		</set>
		where id = #{id, jdbcType=INTEGER}
	</update>
</mapper>