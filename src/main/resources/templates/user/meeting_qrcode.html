<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <title>会议签到二维码</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        #qrcode {
            height: 275px;
            width: 270px;
        }

        html {
            overflow: hidden;
            background: url("/img/back.png");
            background-size: 100% 100%;
            background-repeat: no-repeat;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas {
            height: 275px;
            width: 270px;
            border-radius: 2%;
        }

        .father {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 600px;
            width: 500px;;
            position: relative;
        }

        .son {
            height: 300px;
            width: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

    </style>
    <script th:src="@{/vendor/jquery/jquery.min.js}"></script>
    <script th:src="@{/js/jquery.qrcode.min.js}"></script>
    <script th:src="@{/js/ajax.js}"></script>
    <title>会议签到</title>
</head>
<body>
<div class="father">
    <div class="son">
        <div id="qrcode"></div>
    </div>
    <img th:src="@{/img/sign.png}" height="200px" width="500px" style="position:absolute;bottom:0px;"/>
</div>
<script>
	setInterval(function () {
	    var xhr = new XMLHttpRequest();
	    xhr.open("post","https://api.xiaohuashifu.top/v1/meetings/qrcodes");
	    xhr.setRequestHeader("Authorization", "[[${token}]]");
        var data = new FormData();
        data.append('id', sessionStorage.getItem("meetingId"));
	    xhr.send(data);
        xhr.onreadystatechange = function(){
	        var content = JSON.parse(xhr.response).qrcode;
	        content = sessionStorage.getItem("meetingId") + "," + content;
	        if ($("#qrcode > canvas") == null) {
	            $("#qrcode").qrcode(content);
	        } else {
	            $("#qrcode > canvas").remove();
	            $("#qrcode").qrcode(content)
	        }
	    }
	}, 3000);
	jQuery("#qrcode").qrcode("From SCAU!!!");
</script>
</body>
</html>